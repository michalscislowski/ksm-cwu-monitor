<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Przewodnik Obliczeń Efektywności</title>
  <style>
    @page {
      margin: 2cm 2cm;
      size: A4;
    }

    @page:first {
      margin-top: 1cm;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 10.5pt;
      line-height: 1.6;
      color: #1a1a1a;
      max-width: 850px;
      margin: 0 auto;
      padding: 32px 40px;
      background: white;
    }

    /* Header dokumentu */
    .doc-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%);
      color: white;
      padding: 24px 32px;
      border-radius: 12px;
      margin: -32px -40px 32px -40px;
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .doc-header-icon {
      width: 48px;
      height: 48px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .doc-header-icon svg {
      width: 28px;
      height: 28px;
      stroke: white;
      fill: none;
      stroke-width: 2;
    }

    .doc-header-text h1 {
      font-size: 22pt;
      margin: 0;
      border: none;
      padding: 0;
      color: white;
    }

    .doc-header-text p {
      margin: 4px 0 0 0;
      opacity: 0.85;
      font-size: 11pt;
    }

    /* Nagłówki */
    h1 {
      font-size: 22pt;
      color: #1e3a5f;
      border-bottom: 3px solid #3b82f6;
      padding-bottom: 10px;
      margin-top: 0;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 15pt;
      color: #1e3a5f;
      border-bottom: 2px solid #bfdbfe;
      padding-bottom: 6px;
      margin-top: 32px;
      margin-bottom: 14px;
      page-break-after: avoid;
    }

    h3 {
      font-size: 12pt;
      color: #1d4ed8;
      margin-top: 24px;
      margin-bottom: 10px;
      page-break-after: avoid;
    }

    h4 {
      font-size: 11pt;
      color: #2563eb;
      margin-top: 18px;
      margin-bottom: 8px;
    }

    /* Tabele */
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 16px 0;
      font-size: 9.5pt;
      page-break-inside: avoid;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      overflow: hidden;
    }

    th {
      background: #1e3a5f;
      color: white;
      padding: 10px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 9pt;
    }

    td {
      padding: 8px 12px;
      border-bottom: 1px solid #e5e7eb;
      vertical-align: top;
    }

    tr:nth-child(even) {
      background-color: #f9fafb;
    }

    tr:last-child td {
      border-bottom: none;
    }

    /* Kolorowanie statusów w tabelach */
    td:contains("optimal"), td:contains("Optimal"), td:contains("OPTIMAL") {
      color: #059669;
      font-weight: 600;
    }

    /* Status badges - ręczne znaczniki w tabelach */
    .status-optimal { color: #059669; font-weight: 600; }
    .status-good { color: #0284c7; font-weight: 600; }
    .status-warning { color: #d97706; font-weight: 600; }
    .status-critical { color: #dc2626; font-weight: 600; }

    /* Kod inline */
    code {
      font-family: 'SF Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
      font-size: 9pt;
      background-color: #f1f5f9;
      padding: 2px 6px;
      border-radius: 3px;
      color: #0f172a;
      border: 1px solid #e2e8f0;
    }

    /* Bloki kodu - domyślne */
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 9pt;
      line-height: 1.5;
      page-break-inside: avoid;
      margin: 16px 0;
      border-left: 4px solid #3b82f6;
    }

    pre code {
      background-color: transparent;
      padding: 0;
      color: inherit;
      border: none;
      font-size: 9pt;
      font-family: 'SF Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
    }

    /* ============================================================
       DIAGRAMY ASCII - Technical Blueprint Style
       Inspiracja: schematy inżynierskie, terminale CRT, NASA docs
       ============================================================ */

    pre.diagram {
      /* Tło - ciemny granat z subtelną siatką */
      background:
        linear-gradient(90deg, rgba(56, 189, 248, 0.03) 1px, transparent 1px),
        linear-gradient(rgba(56, 189, 248, 0.03) 1px, transparent 1px),
        linear-gradient(180deg, #020617 0%, #0a1628 50%, #0f172a 100%);
      background-size: 20px 20px, 20px 20px, 100% 100%;

      /* Wymiary i spacing */
      padding: 28px 32px 24px 32px;
      margin: 24px 0;
      border-radius: 8px;
      overflow-x: auto;

      /* Obramowanie - podwójna linia techniczna */
      border: 1px solid #1e3a5f;
      box-shadow:
        inset 0 0 0 1px rgba(56, 189, 248, 0.1),
        0 0 0 1px #0f172a,
        0 4px 24px rgba(0, 0, 0, 0.4),
        0 0 40px rgba(56, 189, 248, 0.05);

      /* Pozycjonowanie dla etykiety */
      position: relative;
    }


    /* Tekst w diagramie */
    pre.diagram code {
      /* Font - czytelny monospace */
      font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', 'Consolas', monospace;
      font-size: 10pt;
      line-height: 1.4;
      letter-spacing: 0;

      /* Kolor bazowy - jasny niebieskoszary */
      color: #cbd5e1;

      /* Wyłącz domyślne style */
      background: transparent;
      border: none;
      padding: 0;
    }

    /* ============================================================
       DIAGRAMY - jednolity kolor tekstu, bez podświetleń
       ============================================================ */

    /* Formuły matematyczne */
    pre.math-formula {
      background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
      color: #854d0e;
      border: 2px solid #fbbf24;
      border-left: 4px solid #f59e0b;
      border-radius: 10px;
      padding: 16px 20px;
      font-size: 10pt;
      text-align: center;
    }

    pre.math-formula code {
      color: #713f12;
      font-size: 10pt;
      font-weight: 500;
    }

    /* Cytaty i uwagi */
    blockquote {
      border-left: 4px solid #3b82f6;
      margin: 16px 0;
      padding: 12px 20px;
      background: #eff6ff;
      color: #1e40af;
      font-style: normal;
      border-radius: 0 6px 6px 0;
    }

    blockquote p {
      margin: 0;
    }

    blockquote strong {
      color: #1d4ed8;
    }

    /* Listy */
    ul, ol {
      padding-left: 24px;
      margin: 12px 0;
    }

    li {
      margin: 6px 0;
    }

    li > ul, li > ol {
      margin: 6px 0;
    }

    /* Linki */
    a {
      color: #2563eb;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    /* Linie poziome */
    hr {
      border: none;
      border-top: 2px solid #e5e7eb;
      margin: 28px 0;
    }

    /* Paragraf */
    p {
      margin: 10px 0;
    }

    /* Strong */
    strong {
      font-weight: 600;
      color: #0f172a;
    }

    /* Pierwsza tabela - meta info */
    body > table:first-of-type,
    h2#informacje-o-dokumencie + table {
      background: #f8fafc;
      border: 2px solid #3b82f6;
    }

    body > table:first-of-type th,
    h2#informacje-o-dokumencie + table th {
      background: #3b82f6;
    }

    /* Stopka */
    .doc-footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid #e5e7eb;
      text-align: center;
      color: #64748b;
      font-size: 9pt;
    }

    /* Print styles */
    @media print {
      body {
        padding: 0;
        max-width: none;
        font-size: 10pt;
      }

      .doc-header {
        margin: 0 0 24px 0;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      h1, h2, h3, h4 {
        page-break-after: avoid;
      }

      table, pre, blockquote {
        page-break-inside: avoid;
      }

      pre {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      th {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      a {
        color: #1e3a5f;
      }

      a[href^="http"]:after {
        content: none;
      }
    }

    /* Spis treści */
    nav#TOC {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px 24px;
      margin-bottom: 24px;
    }

    nav#TOC > ul {
      margin: 0;
      padding-left: 0;
      list-style: none;
    }

    nav#TOC > ul > li {
      margin: 8px 0;
    }

    nav#TOC > ul > li > a {
      font-weight: 600;
      color: #1e3a5f;
    }

    nav#TOC ul ul {
      padding-left: 20px;
      margin-top: 4px;
    }

    nav#TOC ul ul li {
      margin: 4px 0;
    }

    nav#TOC ul ul a {
      color: #475569;
      font-size: 9.5pt;
    }

    /* Kategorie kolorów - dla tabel z kategoriami */
    tr td:first-child:contains("A"),
    td.cat-a {
      color: #059669;
      font-weight: 600;
    }

    tr td:first-child:contains("B"),
    td.cat-b {
      color: #d97706;
      font-weight: 600;
    }

    tr td:first-child:contains("C"),
    td.cat-c {
      color: #dc2626;
      font-weight: 600;
    }
  </style>
</head>
<body>

<div class="doc-header">
  <div class="doc-header-icon">
    <svg viewBox="0 0 24 24">
      <path d="M12 2L2 7l10 5 10-5-10-5z"/>
      <path d="M2 17l10 5 10-5"/>
      <path d="M2 12l10 5 10-5"/>
    </svg>
  </div>
  <div class="doc-header-text">
    <h1>Przewodnik Obliczeń Efektywności</h1>
    <p>CWU Monitor — KSM Przylesie</p>
  </div>
</div>

<nav id="TOC">
<ul>
<li><a href="#przewodnik-obliczeniowy-cwu-monitor"
id="toc-przewodnik-obliczeniowy-cwu-monitor">Przewodnik Obliczeniowy —
CWU Monitor</a>
<ul>
<li><a href="#informacje-o-dokumencie"
id="toc-informacje-o-dokumencie">Informacje o dokumencie</a></li>
<li><a href="#przegląd-systemu" id="toc-przegląd-systemu">1. Przegląd
systemu</a>
<ul>
<li><a href="#źródła-danych" id="toc-źródła-danych">1.1 Źródła
danych</a></li>
<li><a href="#hierarchia-obliczeń" id="toc-hierarchia-obliczeń">1.2
Hierarchia obliczeń</a></li>
</ul></li>
<li><a href="#stałe-i-parametry" id="toc-stałe-i-parametry">2. Stałe i
parametry</a>
<ul>
<li><a href="#stałe-fizyczne" id="toc-stałe-fizyczne">2.1 Stałe
fizyczne</a></li>
<li><a href="#temperatura-wody-zimnej-sezonowa"
id="toc-temperatura-wody-zimnej-sezonowa">2.2 Temperatura wody zimnej
(sezonowa)</a></li>
<li><a href="#godziny-szczytu" id="toc-godziny-szczytu">2.3 Godziny
szczytu</a></li>
</ul></li>
<li><a href="#struktury-danych-wejściowych"
id="toc-struktury-danych-wejściowych">3. Struktury danych
wejściowych</a>
<ul>
<li><a href="#pomiar-z-mec-scada-pojedynczy"
id="toc-pomiar-z-mec-scada-pojedynczy">3.1 Pomiar z MEC SCADA
(pojedynczy)</a></li>
<li><a href="#seria-pomiarów-24h" id="toc-seria-pomiarów-24h">3.2 Seria
pomiarów (24h)</a></li>
<li><a href="#odczyt-ksm-miesięczny" id="toc-odczyt-ksm-miesięczny">3.3
Odczyt KSM (miesięczny)</a></li>
</ul></li>
<li><a href="#obliczenia-krok-po-kroku"
id="toc-obliczenia-krok-po-kroku">4. Obliczenia krok po kroku</a>
<ul>
<li><a href="#krok-1-pobranie-danych-surowych"
id="toc-krok-1-pobranie-danych-surowych">KROK 1: Pobranie danych
surowych</a></li>
<li><a href="#krok-2-obliczenie-wwc-wydajność-wymiany-ciepła"
id="toc-krok-2-obliczenie-wwc-wydajność-wymiany-ciepła">KROK 2:
Obliczenie WWC (Wydajność Wymiany Ciepła)</a></li>
<li><a href="#krok-3-obliczenie-sh-stabilność-hydrauliczna"
id="toc-krok-3-obliczenie-sh-stabilność-hydrauliczna">KROK 3: Obliczenie
SH (Stabilność Hydrauliczna)</a></li>
<li><a href="#krok-4-obliczenie-se-chwilowego-co-15-min"
id="toc-krok-4-obliczenie-se-chwilowego-co-15-min">KROK 4: Obliczenie SE
chwilowego (co 15 min)</a></li>
<li><a href="#krok-5-obliczenie-es-efektywność-szczytowa"
id="toc-krok-5-obliczenie-es-efektywność-szczytowa">KROK 5: Obliczenie
ES (Efektywność Szczytowa)</a></li>
<li><a href="#krok-6-obliczenie-kw-kondycja-wymiennika"
id="toc-krok-6-obliczenie-kw-kondycja-wymiennika">KROK 6: Obliczenie KW
(Kondycja Wymiennika)</a></li>
<li><a href="#krok-7-obliczenie-se-dobowego"
id="toc-krok-7-obliczenie-se-dobowego">KROK 7: Obliczenie SE
dobowego</a></li>
<li><a href="#krok-8-obliczenie-ss-straty-systemowe"
id="toc-krok-8-obliczenie-ss-straty-systemowe">KROK 8: Obliczenie SS
(Straty Systemowe)</a></li>
<li><a href="#krok-9-diagnostyka" id="toc-krok-9-diagnostyka">KROK 9:
Diagnostyka</a></li>
<li><a href="#krok-10-złożenie-wszystkiego"
id="toc-krok-10-złożenie-wszystkiego">KROK 10: Złożenie
wszystkiego</a></li>
</ul></li>
<li><a href="#przykład-kompletnego-obliczenia"
id="toc-przykład-kompletnego-obliczenia">5. Przykład kompletnego
obliczenia</a>
<ul>
<li><a href="#dane-wejściowe" id="toc-dane-wejściowe">Dane
wejściowe</a></li>
<li><a href="#wyniki-pośrednie" id="toc-wyniki-pośrednie">Wyniki
pośrednie</a></li>
<li><a href="#wynik-końcowy" id="toc-wynik-końcowy">Wynik
końcowy</a></li>
</ul></li>
<li><a href="#obsługa-błędów" id="toc-obsługa-błędów">6. Obsługa
błędów</a>
<ul>
<li><a href="#brakujące-dane" id="toc-brakujące-dane">6.1 Brakujące
dane</a></li>
<li><a href="#wartości-odstające" id="toc-wartości-odstające">6.2
Wartości odstające</a></li>
</ul></li>
<li><a href="#podsumowanie-wzorów" id="toc-podsumowanie-wzorów">7.
Podsumowanie wzorów</a></li>
<li><a href="#historia-zmian" id="toc-historia-zmian">8. Historia
zmian</a></li>
</ul></li>
</ul>
</nav>

<h1 id="przewodnik-obliczeniowy-cwu-monitor">Przewodnik Obliczeniowy —
CWU Monitor</h1>
<h2 id="informacje-o-dokumencie">Informacje o dokumencie</h2>
<table>
<colgroup>
<col style="width: 52%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr>
<th>Parametr</th>
<th>Wartość</th>
</tr>
</thead>
<tbody>
<tr>
<td>Wersja</td>
<td>2.0</td>
</tr>
<tr>
<td>Data</td>
<td>2025-01-14</td>
</tr>
<tr>
<td>Przeznaczenie</td>
<td>Dokumentacja techniczna dla programistów i inżynierów</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="przegląd-systemu">1. Przegląd systemu</h2>
<p>System CWU Monitor przetwarza dane z dwóch źródeł i oblicza
hierarchię wskaźników efektywności.</p>
<h3 id="źródła-danych">1.1 Źródła danych</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                         ŹRÓDŁA DANYCH                                   │
│                                                                         │
│  ┌─────────────────────────┐      ┌─────────────────────────────────┐   │
│  │     DANE KSM            │      │     DANE MEC SCADA              │   │
│  │     (miesięczne)        │      │     (co 15 minut)               │   │
│  │                         │      │                                 │   │
│  │  • GJ_miesiac           │      │  • T_zas (temperatura zasil.)   │   │
│  │  • m3_miesiac           │      │  • T_pow (temperatura powr.)    │   │
│  │  • month                │      │  • Q_flow (przepływ m³/h)       │   │
│  │                         │      │  • delta_GJ (przyrost energii)  │   │
│  │                         │      │  • delta_m3 (przyrost wody)     │   │
│  └───────────┬─────────────┘      └───────────────┬─────────────────┘   │
│              │                                    │                     │
│              ▼                                    ▼                     │
│       SE miesięczne                    WWC, SH, ES → KW                 │
│       (historyczne)                    SE bieżące → SS                  │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<h3 id="hierarchia-obliczeń">1.2 Hierarchia obliczeń</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                        KOLEJNOŚĆ OBLICZEŃ                               │
│                                                                         │
│  KROK 1: Dane surowe z MEC SCADA (T_zas, T_pow, Q_flow, delta_GJ, ...)  │
│                           │                                             │
│                           ▼                                             │
│  KROK 2: WWC = f(T_zas, T_pow)          ──┐                             │
│  KROK 3: SH = f(Q_flow[])                 ├── Poziom 3                  │
│  KROK 4: SE_15min = f(delta_GJ, delta_m3) │                             │
│  KROK 5: ES = f(SE_15min[])             ──┘                             │
│                           │                                             │
│                           ▼                                             │
│  KROK 6: KW = ∛(WWC × SH × ES)          ──┐                             │
│  KROK 7: SE_dobowe = f(suma GJ, suma m3)  ├── Poziom 2 + 1              │
│  KROK 8: SS = f(SE, KW)                 ──┘                             │
│                           │                                             │
│                           ▼                                             │
│  KROK 9: Diagnostyka (primary_issue, limiting_factor)                   │
│  KROK 10: Alerty i rekomendacje                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr />
<h2 id="stałe-i-parametry">2. Stałe i parametry</h2>
<h3 id="stałe-fizyczne">2.1 Stałe fizyczne</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stałe globalne</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> T_CWU <span class="op">=</span> <span class="dv">55</span><span class="op">;</span>                    <span class="co">// Temperatura docelowa CWU [°C]</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SPECIFIC_HEAT <span class="op">=</span> <span class="fl">0.004186</span><span class="op">;</span>      <span class="co">// Ciepło właściwe wody [GJ/(m³·K)]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MIN_LOSSES_FACTOR <span class="op">=</span> <span class="fl">1.05</span><span class="op">;</span>      <span class="co">// 5% nieuniknionych strat</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> DELTA_T_OPTIMAL <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>          <span class="co">// Optymalna różnica temperatur [K]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> OPTIMAL_WSKAZNIK <span class="op">=</span> <span class="fl">0.22</span><span class="op">;</span>       <span class="co">// Optymalny wskaźnik [GJ/m³]</span></span></code></pre></div>
<h3 id="temperatura-wody-zimnej-sezonowa">2.2 Temperatura wody zimnej
(sezonowa)</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Temperatura wody zimnej dla regionu Koszalina [°C]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SEASONAL_T_COLD<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">number</span><span class="op">,</span> <span class="dt">number</span><span class="op">&gt;</span> <span class="op">=</span> {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span>    <span class="co">// Styczeń</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span>    <span class="co">// Luty</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span><span class="op">:</span> <span class="dv">7</span><span class="op">,</span>    <span class="co">// Marzec</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span>   <span class="co">// Kwiecień</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span><span class="op">:</span> <span class="dv">13</span><span class="op">,</span>   <span class="co">// Maj</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span>   <span class="co">// Czerwiec</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span>   <span class="co">// Lipiec</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span>   <span class="co">// Sierpień</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span>   <span class="co">// Wrzesień</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span><span class="op">:</span> <span class="dv">12</span><span class="op">,</span>  <span class="co">// Październik</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">11</span><span class="op">:</span> <span class="dv">9</span><span class="op">,</span>   <span class="co">// Listopad</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">12</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span>   <span class="co">// Grudzień</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSeasonalTCold</span>(month<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">number</span> {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> SEASONAL_T_COLD[month] <span class="op">??</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="godziny-szczytu">2.3 Godziny szczytu</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Godziny szczytu zużycia CWU</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> PEAK_HOURS_MORNING <span class="op">=</span> [<span class="dv">7</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">;</span>           <span class="co">// 7:00-9:00</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> PEAK_HOURS_EVENING <span class="op">=</span> [<span class="dv">17</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">19</span><span class="op">,</span> <span class="dv">20</span>]<span class="op">;</span> <span class="co">// 17:00-21:00</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> PEAK_HOURS <span class="op">=</span> [<span class="op">...</span>PEAK_HOURS_MORNING<span class="op">,</span> <span class="op">...</span>PEAK_HOURS_EVENING]<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="struktury-danych-wejściowych">3. Struktury danych
wejściowych</h2>
<h3 id="pomiar-z-mec-scada-pojedynczy">3.1 Pomiar z MEC SCADA
(pojedynczy)</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ScadaMeasurement {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  node_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>      <span class="co">// ISO 8601</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  T_zas<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>          <span class="co">// Temperatura zasilania [°C]</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  T_pow<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>          <span class="co">// Temperatura powrotu [°C]</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  Q_flow<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>         <span class="co">// Przepływ chwilowy [m³/h]</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  delta_GJ<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>       <span class="co">// Przyrost energii od ostatniego pomiaru [GJ]</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  delta_m3<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>       <span class="co">// Przyrost objętości od ostatniego pomiaru [m³]</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="seria-pomiarów-24h">3.2 Seria pomiarów (24h)</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> DailyMeasurements {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  node_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  date<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>           <span class="co">// YYYY-MM-DD</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  measurements<span class="op">:</span> ScadaMeasurement[]<span class="op">;</span>  <span class="co">// 96 pomiarów (co 15 min)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="odczyt-ksm-miesięczny">3.3 Odczyt KSM (miesięczny)</h3>
<div class="sourceCode" id="cb8"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> KsmMonthlyReading {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  node_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  year<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  month<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>          <span class="co">// 1-12</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  gj<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>             <span class="co">// Energia za miesiąc [GJ]</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  m3<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>             <span class="co">// Objętość za miesiąc [m³]</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  wskaznik<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>       <span class="co">// gj / m3 [GJ/m³]</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="obliczenia-krok-po-kroku">4. Obliczenia krok po kroku</h2>
<h3 id="krok-1-pobranie-danych-surowych">KROK 1: Pobranie danych
surowych</h3>
<p><strong>Cel:</strong> Zebranie 96 pomiarów z MEC SCADA za ostatnie
24h.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">fetchDailyMeasurements</span>(nodeId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> date<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>DailyMeasurements<span class="op">&gt;</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pobierz 96 pomiarów (co 15 min przez 24h)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> measurements <span class="op">=</span> <span class="cf">await</span> mecApi<span class="op">.</span><span class="fu">getMeasurements</span>(nodeId<span class="op">,</span> date)<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    node_id<span class="op">:</span> nodeId<span class="op">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    date<span class="op">:</span> date<span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    measurements<span class="op">:</span> measurements<span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład danych:</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;node_id&quot;</span><span class="fu">:</span> <span class="st">&quot;WC-001&quot;</span><span class="fu">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-01-14&quot;</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;measurements&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span> <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-01-14T00:00:00Z&quot;</span><span class="fu">,</span> <span class="dt">&quot;T_zas&quot;</span><span class="fu">:</span> <span class="fl">67.2</span><span class="fu">,</span> <span class="dt">&quot;T_pow&quot;</span><span class="fu">:</span> <span class="fl">51.8</span><span class="fu">,</span> <span class="dt">&quot;Q_flow&quot;</span><span class="fu">:</span> <span class="fl">1.82</span><span class="fu">,</span> <span class="dt">&quot;delta_GJ&quot;</span><span class="fu">:</span> <span class="fl">0.08</span><span class="fu">,</span> <span class="dt">&quot;delta_m3&quot;</span><span class="fu">:</span> <span class="fl">0.32</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span> <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-01-14T00:15:00Z&quot;</span><span class="fu">,</span> <span class="dt">&quot;T_zas&quot;</span><span class="fu">:</span> <span class="fl">67.5</span><span class="fu">,</span> <span class="dt">&quot;T_pow&quot;</span><span class="fu">:</span> <span class="fl">52.1</span><span class="fu">,</span> <span class="dt">&quot;Q_flow&quot;</span><span class="fu">:</span> <span class="fl">1.75</span><span class="fu">,</span> <span class="dt">&quot;delta_GJ&quot;</span><span class="fu">:</span> <span class="fl">0.07</span><span class="fu">,</span> <span class="dt">&quot;delta_m3&quot;</span><span class="fu">:</span> <span class="fl">0.30</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">//</span> <span class="er">...</span> <span class="dv">94</span> <span class="er">kolejne</span> <span class="er">pomiary</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h3 id="krok-2-obliczenie-wwc-wydajność-wymiany-ciepła">KROK 2:
Obliczenie WWC (Wydajność Wymiany Ciepła)</h3>
<p><strong>Cel:</strong> Ocena efektywności wymiennika na podstawie
różnicy temperatur.</p>
<p><strong>Wzór:</strong></p>
<pre><code>WWC = 100 × (ΔT_średnie / ΔT_optymalne)

gdzie:
  ΔT_średnie = średnia(T_zas - T_pow) z wszystkich pomiarów
  ΔT_optymalne = 20 K</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> WWCResult {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>           <span class="co">// 0-100%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> IndicatorStatus<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  avg_delta_T<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>     <span class="co">// Średnia ΔT [K]</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  interpretation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateWWC</span>(measurements<span class="op">:</span> ScadaMeasurement[])<span class="op">:</span> WWCResult {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Oblicz ΔT dla każdego pomiaru</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaTs <span class="op">=</span> measurements<span class="op">.</span><span class="fu">map</span>(m <span class="kw">=&gt;</span> m<span class="op">.</span><span class="at">T_zas</span> <span class="op">-</span> m<span class="op">.</span><span class="at">T_pow</span>)<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Średnia ΔT</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> avgDeltaT <span class="op">=</span> deltaTs<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> dt) <span class="kw">=&gt;</span> sum <span class="op">+</span> dt<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> deltaTs<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// WWC = (ΔT_średnie / ΔT_optymalne) × 100</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wwcRaw <span class="op">=</span> (avgDeltaT <span class="op">/</span> DELTA_T_OPTIMAL) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Ograniczenie do 0-100%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">100</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> wwcRaw)))<span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Określenie statusu (progi: 95/85/70)</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> status <span class="op">=</span> <span class="fu">getWWCStatus</span>(value)<span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Interpretacja</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interpretation <span class="op">=</span> <span class="fu">getWWCInterpretation</span>(value)<span class="op">;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    value<span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    status<span class="op">,</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    avg_delta_T<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(avgDeltaT <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    interpretation<span class="op">,</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getWWCStatus</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> IndicatorStatus {</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">95</span>) <span class="cf">return</span> <span class="st">&#39;optimal&#39;</span><span class="op">;</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">85</span>) <span class="cf">return</span> <span class="st">&#39;good&#39;</span><span class="op">;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">70</span>) <span class="cf">return</span> <span class="st">&#39;warning&#39;</span><span class="op">;</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia:</strong></p>
<pre><code>Pomiary ΔT: [15.4, 15.9, 16.2, 15.8, 16.1, ...]  (96 wartości)

ΔT_średnie = 16.2 K
WWC = (16.2 / 20) × 100 = 81%

Status: &quot;good&quot; (81% ≥ 85% → nie, 81% ≥ 70% → tak)
Interpretacja: &quot;Dobra wymiana ciepła, możliwa drobna optymalizacja&quot;</code></pre>
<hr />
<h3 id="krok-3-obliczenie-sh-stabilność-hydrauliczna">KROK 3: Obliczenie
SH (Stabilność Hydrauliczna)</h3>
<p><strong>Cel:</strong> Ocena równomierności przepływu w ciągu
doby.</p>
<p><strong>Wzór:</strong></p>
<pre><code>SH = 100 - (CV × 100)

gdzie:
  CV = σ(Q) / μ(Q)
  σ(Q) = odchylenie standardowe przepływu
  μ(Q) = średni przepływ</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> SHResult {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>           <span class="co">// 0-100%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> IndicatorStatus<span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  flow_mean<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>       <span class="co">// μ(Q) [m³/h]</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  flow_std<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>        <span class="co">// σ(Q) [m³/h]</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  cv<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>              <span class="co">// Współczynnik zmienności</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  interpretation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateSH</span>(measurements<span class="op">:</span> ScadaMeasurement[])<span class="op">:</span> SHResult {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pobierz wszystkie przepływy</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flows <span class="op">=</span> measurements<span class="op">.</span><span class="fu">map</span>(m <span class="kw">=&gt;</span> m<span class="op">.</span><span class="at">Q_flow</span>)<span class="op">;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Średnia przepływu μ(Q)</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flowMean <span class="op">=</span> flows<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> q) <span class="kw">=&gt;</span> sum <span class="op">+</span> q<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> flows<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Odchylenie standardowe σ(Q)</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> squaredDiffs <span class="op">=</span> flows<span class="op">.</span><span class="fu">map</span>(q <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q <span class="op">-</span> flowMean<span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> variance <span class="op">=</span> squaredDiffs<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> sq) <span class="kw">=&gt;</span> sum <span class="op">+</span> sq<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> flows<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flowStd <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(variance)<span class="op">;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Współczynnik zmienności CV</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv <span class="op">=</span> flowMean <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> flowStd <span class="op">/</span> flowMean <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// SH = 100 - (CV × 100)</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shRaw <span class="op">=</span> <span class="dv">100</span> <span class="op">-</span> (cv <span class="op">*</span> <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Ograniczenie do 0-100%</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">100</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> shRaw)))<span class="op">;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Status (progi: 90/80/70)</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> status <span class="op">=</span> <span class="fu">getSHStatus</span>(value)<span class="op">;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    value<span class="op">,</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    status<span class="op">,</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    flow_mean<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(flowMean <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    flow_std<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(flowStd <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(cv <span class="op">*</span> <span class="dv">1000</span>) <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    interpretation<span class="op">:</span> <span class="fu">getSHInterpretation</span>(value)<span class="op">,</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSHStatus</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> IndicatorStatus {</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">90</span>) <span class="cf">return</span> <span class="st">&#39;optimal&#39;</span><span class="op">;</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">80</span>) <span class="cf">return</span> <span class="st">&#39;good&#39;</span><span class="op">;</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">70</span>) <span class="cf">return</span> <span class="st">&#39;warning&#39;</span><span class="op">;</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia:</strong></p>
<pre><code>Przepływy Q: [1.82, 1.75, 1.90, 2.45, 3.12, 2.85, ...]  (96 wartości)

μ(Q) = 2.45 m³/h
σ(Q) = 0.52 m³/h
CV = 0.52 / 2.45 = 0.212

SH = 100 - (0.212 × 100) = 78.8% ≈ 79%

Status: &quot;warning&quot; (79% &lt; 80%)
Interpretacja: &quot;Znaczne wahania przepływu - nierównomierne obciążenie pionów&quot;</code></pre>
<hr />
<h3 id="krok-4-obliczenie-se-chwilowego-co-15-min">KROK 4: Obliczenie SE
chwilowego (co 15 min)</h3>
<p><strong>Cel:</strong> Sprawność energetyczna dla każdego
15-minutowego okresu.</p>
<p><strong>Wzór:</strong></p>
<pre><code>SE_15min = (Q_teoretyczne / Q_rzeczywiste) × 100

gdzie:
  Q_teoretyczne = delta_m3 × c × ΔT × k_straty
  Q_rzeczywiste = delta_GJ
  ΔT = T_CWU - T_zimna = 55 - T_zimna[month]</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> SE15minResult {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  se<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>              <span class="co">// SE dla tego okresu [%]</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  q_theoretical<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>   <span class="co">// [GJ]</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  q_actual<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>        <span class="co">// [GJ]</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateSE15min</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  measurement<span class="op">:</span> ScadaMeasurement<span class="op">,</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  month<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> SE15minResult {</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tCold <span class="op">=</span> <span class="fu">getSeasonalTCold</span>(month)<span class="op">;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaT <span class="op">=</span> T_CWU <span class="op">-</span> tCold<span class="op">;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Q_teoretyczne = V × c × ΔT × k_straty</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qTheoretical <span class="op">=</span> measurement<span class="op">.</span><span class="at">delta_m3</span> <span class="op">*</span> SPECIFIC_HEAT <span class="op">*</span> deltaT <span class="op">*</span> MIN_LOSSES_FACTOR<span class="op">;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Q_rzeczywiste = delta_GJ</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qActual <span class="op">=</span> measurement<span class="op">.</span><span class="at">delta_GJ</span><span class="op">;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// SE = (Q_teoretyczne / Q_rzeczywiste) × 100</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Zabezpieczenie przed dzieleniem przez zero</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> se <span class="op">=</span> qActual <span class="op">&gt;</span> <span class="fl">0.001</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((qTheoretical <span class="op">/</span> qActual) <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">:</span> measurement<span class="op">.</span><span class="at">timestamp</span><span class="op">,</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    se<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">120</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> se))<span class="op">,</span>  <span class="co">// Ograniczenie do rozsądnego zakresu</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    q_theoretical<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(qTheoretical <span class="op">*</span> <span class="dv">1000</span>) <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    q_actual<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(qActual <span class="op">*</span> <span class="dv">1000</span>) <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Obliczenie dla wszystkich pomiarów</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateAllSE15min</span>(</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  measurements<span class="op">:</span> ScadaMeasurement[]<span class="op">,</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  month<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> SE15minResult[] {</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> measurements<span class="op">.</span><span class="fu">map</span>(m <span class="kw">=&gt;</span> <span class="fu">calculateSE15min</span>(m<span class="op">,</span> month))<span class="op">;</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia (styczeń, pojedynczy
pomiar):</strong></p>
<pre><code>delta_m3 = 0.58 m³
delta_GJ = 0.142 GJ
T_zimna = 5°C (styczeń)

ΔT = 55 - 5 = 50 K
Q_teoretyczne = 0.58 × 0.004186 × 50 × 1.05 = 0.127 GJ
Q_rzeczywiste = 0.142 GJ

SE_15min = (0.127 / 0.142) × 100 = 89.6% ≈ 90%</code></pre>
<hr />
<h3 id="krok-5-obliczenie-es-efektywność-szczytowa">KROK 5: Obliczenie
ES (Efektywność Szczytowa)</h3>
<p><strong>Cel:</strong> Porównanie sprawności w godzinach szczytu ze
średnią dobową.</p>
<p><strong>Wzór:</strong></p>
<pre><code>ES = 100 × (SE_szczyt / SE_średnia)

gdzie:
  SE_szczyt = średnia SE w godzinach 7-9 i 17-21
  SE_średnia = średnia SE całodobowa</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ESResult {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>           <span class="co">// 0-100%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> IndicatorStatus<span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  se_peak<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>         <span class="co">// Średnia SE w szczycie [%]</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  se_average<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>      <span class="co">// Średnia SE całodobowa [%]</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  worst_hours<span class="op">:</span> <span class="dt">number</span>[]<span class="op">;</span>   <span class="co">// Godziny z najniższym SE</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  interpretation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateES</span>(se15minResults<span class="op">:</span> SE15minResult[])<span class="op">:</span> ESResult {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Agregacja godzinowa</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourlyData <span class="op">=</span> <span class="fu">aggregateByHour</span>(se15minResults)<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Średnia całodobowa</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> seAverage <span class="op">=</span> hourlyData<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> h) <span class="kw">=&gt;</span> sum <span class="op">+</span> h<span class="op">.</span><span class="at">se</span><span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> hourlyData<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Średnia w godzinach szczytu (7-9, 17-21)</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> peakHourData <span class="op">=</span> hourlyData<span class="op">.</span><span class="fu">filter</span>(h <span class="kw">=&gt;</span> PEAK_HOURS<span class="op">.</span><span class="fu">includes</span>(h<span class="op">.</span><span class="at">hour</span>))<span class="op">;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sePeak <span class="op">=</span> peakHourData<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> h) <span class="kw">=&gt;</span> sum <span class="op">+</span> h<span class="op">.</span><span class="at">se</span><span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> peakHourData<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ES = (SE_szczyt / SE_średnia) × 100</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> esRaw <span class="op">=</span> seAverage <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (sePeak <span class="op">/</span> seAverage) <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">100</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> esRaw)))<span class="op">;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Znajdź godziny z najniższym SE</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> worstHours <span class="op">=</span> <span class="fu">findWorstHours</span>(hourlyData<span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    value<span class="op">,</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> <span class="fu">getESStatus</span>(value)<span class="op">,</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    se_peak<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(sePeak)<span class="op">,</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    se_average<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(seAverage)<span class="op">,</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    worst_hours<span class="op">:</span> worstHours<span class="op">,</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    interpretation<span class="op">:</span> <span class="fu">getESInterpretation</span>(value<span class="op">,</span> worstHours)<span class="op">,</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">aggregateByHour</span>(se15minResults<span class="op">:</span> SE15minResult[])<span class="op">:</span> { hour<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> se<span class="op">:</span> <span class="dt">number</span> }[] {</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourlyMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="dt">number</span><span class="op">,</span> <span class="dt">number</span>[]<span class="op">&gt;</span>()<span class="op">;</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> result <span class="kw">of</span> se15minResults) {</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hour <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(result<span class="op">.</span><span class="at">timestamp</span>)<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>hourlyMap<span class="op">.</span><span class="fu">has</span>(hour)) {</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>      hourlyMap<span class="op">.</span><span class="fu">set</span>(hour<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    hourlyMap<span class="op">.</span><span class="fu">get</span>(hour)<span class="op">!.</span><span class="fu">push</span>(result<span class="op">.</span><span class="at">se</span>)<span class="op">;</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(hourlyMap<span class="op">.</span><span class="fu">entries</span>())<span class="op">.</span><span class="fu">map</span>(([hour<span class="op">,</span> values]) <span class="kw">=&gt;</span> ({</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    hour<span class="op">,</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    se<span class="op">:</span> values<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> v) <span class="kw">=&gt;</span> sum <span class="op">+</span> v<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> values<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">findWorstHours</span>(hourlyData<span class="op">:</span> { hour<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> se<span class="op">:</span> <span class="dt">number</span> }[]<span class="op">,</span> count<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">number</span>[] {</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> hourlyData</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">se</span> <span class="op">-</span> b<span class="op">.</span><span class="at">se</span>)</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> count)</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(h <span class="kw">=&gt;</span> h<span class="op">.</span><span class="at">hour</span>)<span class="op">;</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getESStatus</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> IndicatorStatus {</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">90</span>) <span class="cf">return</span> <span class="st">&#39;optimal&#39;</span><span class="op">;</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">80</span>) <span class="cf">return</span> <span class="st">&#39;good&#39;</span><span class="op">;</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">70</span>) <span class="cf">return</span> <span class="st">&#39;warning&#39;</span><span class="op">;</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia:</strong></p>
<pre><code>SE godzinowe:
  [0:00] 95%, [1:00] 96%, ..., [7:00] 78%, [8:00] 75%, ...,
  [17:00] 72%, [18:00] 74%, [19:00] 76%, [20:00] 73%, ...

SE_średnia = 85%
SE_szczyt (godziny 7,8,17,18,19,20) = (78+75+72+74+76+73)/6 = 74.7%

ES = (74.7 / 85) × 100 = 87.9% ≈ 88%

Status: &quot;good&quot; (88% ≥ 80%)
worst_hours: [17, 18, 8, 7]</code></pre>
<hr />
<h3 id="krok-6-obliczenie-kw-kondycja-wymiennika">KROK 6: Obliczenie KW
(Kondycja Wymiennika)</h3>
<p><strong>Cel:</strong> Agregacja WWC, SH, ES w jeden wskaźnik.</p>
<p><strong>Wzór:</strong></p>
<pre><code>KW = ∛(WWC × SH × ES)</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> KWResult {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>           <span class="co">// 0-100%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> IndicatorStatus<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  limiting_factor<span class="op">:</span> <span class="st">&#39;wwc&#39;</span> <span class="op">|</span> <span class="st">&#39;sh&#39;</span> <span class="op">|</span> <span class="st">&#39;es&#39;</span><span class="op">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  interpretation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateKW</span>(wwc<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> sh<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> es<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> KWResult {</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Średnia geometryczna</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kwRaw <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(wwc <span class="op">*</span> sh <span class="op">*</span> es<span class="op">,</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(kwRaw)<span class="op">;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Czynnik ograniczający (najniższy)</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> min <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(wwc<span class="op">,</span> sh<span class="op">,</span> es)<span class="op">;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> limiting_factor<span class="op">:</span> <span class="st">&#39;wwc&#39;</span> <span class="op">|</span> <span class="st">&#39;sh&#39;</span> <span class="op">|</span> <span class="st">&#39;es&#39;</span> <span class="op">=</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    min <span class="op">===</span> wwc <span class="op">?</span> <span class="st">&#39;wwc&#39;</span> <span class="op">:</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    min <span class="op">===</span> sh <span class="op">?</span> <span class="st">&#39;sh&#39;</span> <span class="op">:</span> <span class="st">&#39;es&#39;</span><span class="op">;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Status</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> status <span class="op">=</span> <span class="fu">getKWStatus</span>(value)<span class="op">;</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Interpretacja</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interpretation <span class="op">=</span> <span class="fu">getKWInterpretation</span>(value<span class="op">,</span> limiting_factor)<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    value<span class="op">,</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    status<span class="op">,</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    limiting_factor<span class="op">,</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    interpretation<span class="op">,</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getKWStatus</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> IndicatorStatus {</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">90</span>) <span class="cf">return</span> <span class="st">&#39;optimal&#39;</span><span class="op">;</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">80</span>) <span class="cf">return</span> <span class="st">&#39;good&#39;</span><span class="op">;</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">70</span>) <span class="cf">return</span> <span class="st">&#39;warning&#39;</span><span class="op">;</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getKWInterpretation</span>(value<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> limitingFactor<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> factorNames <span class="op">=</span> {</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    wwc<span class="op">:</span> <span class="st">&#39;wymiana ciepła&#39;</span><span class="op">,</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    sh<span class="op">:</span> <span class="st">&#39;stabilność hydrauliczna&#39;</span><span class="op">,</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    es<span class="op">:</span> <span class="st">&#39;efektywność szczytowa&#39;</span><span class="op">,</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">90</span>) <span class="cf">return</span> <span class="st">&#39;Wymiennik pracuje bardzo dobrze&#39;</span><span class="op">;</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">80</span>) <span class="cf">return</span> <span class="vs">`Wymiennik sprawny, ogranicza: </span><span class="sc">${</span>factorNames[limitingFactor]<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">70</span>) <span class="cf">return</span> <span class="vs">`Wymiennik wymaga uwagi - słaba </span><span class="sc">${</span>factorNames[limitingFactor]<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`Wymiennik w stanie krytycznym - </span><span class="sc">${</span>factorNames[limitingFactor]<span class="sc">}</span><span class="vs"> na niskim poziomie`</span><span class="op">;</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia:</strong></p>
<pre><code>WWC = 81%
SH = 79%
ES = 88%

KW = ∛(81 × 79 × 88) = ∛563112 = 82.6% ≈ 83%

limiting_factor = &quot;sh&quot; (79% jest najniższe)
Status: &quot;good&quot;
Interpretacja: &quot;Wymiennik sprawny, ogranicza: stabilność hydrauliczna&quot;</code></pre>
<hr />
<h3 id="krok-7-obliczenie-se-dobowego">KROK 7: Obliczenie SE
dobowego</h3>
<p><strong>Cel:</strong> Sprawność energetyczna za całą dobę.</p>
<p><strong>Wzór:</strong></p>
<pre><code>SE_dobowe = (Q_teoretyczne_suma / Q_rzeczywiste_suma) × 100</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> SEDailyResult {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>           <span class="co">// 0-100%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> IndicatorStatus<span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  losses_percent<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>  <span class="co">// 100 - SE</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  q_theoretical<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>   <span class="co">// Suma teoretyczna [GJ]</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  q_actual<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>        <span class="co">// Suma rzeczywista [GJ]</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  t_cold<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>          <span class="co">// Użyta T_zimna [°C]</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  interpretation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateSEDaily</span>(</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  measurements<span class="op">:</span> ScadaMeasurement[]<span class="op">,</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  month<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> SEDailyResult {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Suma GJ i m³ za dobę</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalGJ <span class="op">=</span> measurements<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> m) <span class="kw">=&gt;</span> sum <span class="op">+</span> m<span class="op">.</span><span class="at">delta_GJ</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalM3 <span class="op">=</span> measurements<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> m) <span class="kw">=&gt;</span> sum <span class="op">+</span> m<span class="op">.</span><span class="at">delta_m3</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parametry sezonowe</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tCold <span class="op">=</span> <span class="fu">getSeasonalTCold</span>(month)<span class="op">;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaT <span class="op">=</span> T_CWU <span class="op">-</span> tCold<span class="op">;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Q_teoretyczne = V × c × ΔT × k_straty</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qTheoretical <span class="op">=</span> totalM3 <span class="op">*</span> SPECIFIC_HEAT <span class="op">*</span> deltaT <span class="op">*</span> MIN_LOSSES_FACTOR<span class="op">;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// SE = (Q_teoretyczne / Q_rzeczywiste) × 100</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> seRaw <span class="op">=</span> totalGJ <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (qTheoretical <span class="op">/</span> totalGJ) <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">100</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> seRaw)))<span class="op">;</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lossesPercent <span class="op">=</span> <span class="dv">100</span> <span class="op">-</span> value<span class="op">;</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    value<span class="op">,</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> <span class="fu">getSEStatus</span>(value)<span class="op">,</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    losses_percent<span class="op">:</span> lossesPercent<span class="op">,</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    q_theoretical<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(qTheoretical <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    q_actual<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(totalGJ <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    t_cold<span class="op">:</span> tCold<span class="op">,</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    interpretation<span class="op">:</span> <span class="fu">getSEInterpretation</span>(value<span class="op">,</span> lossesPercent)<span class="op">,</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSEStatus</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> IndicatorStatus {</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">80</span>) <span class="cf">return</span> <span class="st">&#39;optimal&#39;</span><span class="op">;</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">70</span>) <span class="cf">return</span> <span class="st">&#39;good&#39;</span><span class="op">;</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&gt;=</span> <span class="dv">60</span>) <span class="cf">return</span> <span class="st">&#39;warning&#39;</span><span class="op">;</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia (styczeń):</strong></p>
<pre><code>Suma z 96 pomiarów:
  total_GJ = 4.82 GJ
  total_m3 = 19.2 m³

T_zimna = 5°C
ΔT = 55 - 5 = 50 K

Q_teoretyczne = 19.2 × 0.004186 × 50 × 1.05 = 4.22 GJ
Q_rzeczywiste = 4.82 GJ

SE_dobowe = (4.22 / 4.82) × 100 = 87.6% ≈ 88%

losses_percent = 100 - 88 = 12%
Status: &quot;optimal&quot;</code></pre>
<hr />
<h3 id="krok-8-obliczenie-ss-straty-systemowe">KROK 8: Obliczenie SS
(Straty Systemowe)</h3>
<p><strong>Cel:</strong> Oszacowanie strat poza wymiennikiem.</p>
<p><strong>Wzór:</strong></p>
<pre><code>SS = 100 × (1 - SE/KW)    gdy KW &gt; SE
SS = 0                     gdy KW ≤ SE</code></pre>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> SSResult {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>           <span class="co">// 0-100%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> IndicatorStatus<span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  estimated_circulation<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>  <span class="co">// Szacunkowe straty cyrkulacji [%]</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  estimated_pipes<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>        <span class="co">// Szacunkowe straty rur [%]</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  night_ratio<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>            <span class="co">// Q_noc / Q_dzień</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  interpretation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  action<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateSS</span>(</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  seValue<span class="op">:</span> <span class="dt">number</span><span class="op">,</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  kwValue<span class="op">:</span> <span class="dt">number</span><span class="op">,</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  measurements<span class="op">:</span> ScadaMeasurement[]</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> SSResult {</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Oblicz night_ratio</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightRatio <span class="op">=</span> <span class="fu">calculateNightRatio</span>(measurements)<span class="op">;</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// SS = 100 × (1 - SE/KW) gdy KW &gt; SE</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> ssRaw <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (kwValue <span class="op">&gt;</span> seValue <span class="op">&amp;&amp;</span> kwValue <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    ssRaw <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> seValue <span class="op">/</span> kwValue)<span class="op">;</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> ssRaw))<span class="op">;</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Szacunkowy podział strat</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Wyższy night_ratio = większy udział cyrkulacji</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> circulationShare <span class="op">=</span> <span class="fl">0.7</span> <span class="op">+</span> (nightRatio <span class="op">-</span> <span class="fl">0.15</span>) <span class="op">*</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clampedShare <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="fl">0.9</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.5</span><span class="op">,</span> circulationShare))<span class="op">;</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> estimatedCirculation <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value <span class="op">*</span> clampedShare)<span class="op">;</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> estimatedPipes <span class="op">=</span> value <span class="op">-</span> estimatedCirculation<span class="op">;</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Status (progi: &lt;10 / 10-20 / 20-30 / &gt;30)</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> status <span class="op">=</span> <span class="fu">getSSStatus</span>(value)<span class="op">;</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Interpretacja i akcja</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { interpretation<span class="op">,</span> action } <span class="op">=</span> <span class="fu">getSSInterpretation</span>(value<span class="op">,</span> nightRatio)<span class="op">;</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    value<span class="op">,</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    status<span class="op">,</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    estimated_circulation<span class="op">:</span> estimatedCirculation<span class="op">,</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    estimated_pipes<span class="op">:</span> estimatedPipes<span class="op">,</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    night_ratio<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(nightRatio <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    interpretation<span class="op">,</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateNightRatio</span>(measurements<span class="op">:</span> ScadaMeasurement[])<span class="op">:</span> <span class="dt">number</span> {</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Zużycie nocne (22:00-6:00) vs dzienne (6:00-22:00)</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> nightGJ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dayGJ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> m <span class="kw">of</span> measurements) {</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hour <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(m<span class="op">.</span><span class="at">timestamp</span>)<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (hour <span class="op">&gt;=</span> <span class="dv">22</span> <span class="op">||</span> hour <span class="op">&lt;</span> <span class="dv">6</span>) {</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>      nightGJ <span class="op">+=</span> m<span class="op">.</span><span class="at">delta_GJ</span><span class="op">;</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>      dayGJ <span class="op">+=</span> m<span class="op">.</span><span class="at">delta_GJ</span><span class="op">;</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dayGJ <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> nightGJ <span class="op">/</span> dayGJ <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSSStatus</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> IndicatorStatus {</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&lt;</span> <span class="dv">10</span>) <span class="cf">return</span> <span class="st">&#39;optimal&#39;</span><span class="op">;</span></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&lt;</span> <span class="dv">20</span>) <span class="cf">return</span> <span class="st">&#39;good&#39;</span><span class="op">;</span></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&lt;</span> <span class="dv">30</span>) <span class="cf">return</span> <span class="st">&#39;warning&#39;</span><span class="op">;</span></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Przykład obliczenia:</strong></p>
<pre><code>SE = 78%
KW = 83%
night_ratio = 0.22

SS = 100 × (1 - 78/83) = 100 × 0.060 = 6%

circulationShare = 0.7 + (0.22 - 0.15) × 0.5 = 0.735
estimated_circulation = 6 × 0.735 = 4.4% ≈ 4%
estimated_pipes = 6 - 4 = 2%

Status: &quot;optimal&quot; (6% &lt; 10%)</code></pre>
<hr />
<h3 id="krok-9-diagnostyka">KROK 9: Diagnostyka</h3>
<p><strong>Cel:</strong> Określenie głównego problemu i potencjału
oszczędności.</p>
<p><strong>Implementacja:</strong></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> DiagnosticResult {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  primary_issue<span class="op">:</span> <span class="st">&#39;exchanger&#39;</span> <span class="op">|</span> <span class="st">&#39;circulation&#39;</span> <span class="op">|</span> <span class="st">&#39;balanced&#39;</span> <span class="op">|</span> <span class="st">&#39;unknown&#39;</span><span class="op">;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  savings_potential_percent<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  savings_potential_gj<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  recommendations<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">diagnose</span>(</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  se<span class="op">:</span> SEDailyResult<span class="op">,</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  kw<span class="op">:</span> KWResult<span class="op">,</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  ss<span class="op">:</span> SSResult<span class="op">,</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  annualGJ<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> DiagnosticResult {</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Określenie głównego problemu</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> primary_issue<span class="op">:</span> DiagnosticResult[<span class="st">&#39;primary_issue&#39;</span>]<span class="op">;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (se<span class="op">.</span><span class="at">value</span> <span class="op">&gt;=</span> <span class="dv">75</span> <span class="op">&amp;&amp;</span> kw<span class="op">.</span><span class="at">value</span> <span class="op">&gt;=</span> <span class="dv">80</span>) {</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    primary_issue <span class="op">=</span> <span class="st">&#39;balanced&#39;</span><span class="op">;</span>  <span class="co">// Wszystko OK</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (kw<span class="op">.</span><span class="at">value</span> <span class="op">&lt;</span> <span class="dv">75</span>) {</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    primary_issue <span class="op">=</span> <span class="st">&#39;exchanger&#39;</span><span class="op">;</span> <span class="co">// Problem z wymiennikiem</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ss<span class="op">.</span><span class="at">value</span> <span class="op">&gt;</span> <span class="dv">20</span>) {</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    primary_issue <span class="op">=</span> <span class="st">&#39;circulation&#39;</span><span class="op">;</span> <span class="co">// Problem z cyrkulacją</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    primary_issue <span class="op">=</span> <span class="st">&#39;unknown&#39;</span><span class="op">;</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Potencjał oszczędności (do SE = 80%)</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> targetSE <span class="op">=</span> <span class="dv">80</span><span class="op">;</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentLosses <span class="op">=</span> se<span class="op">.</span><span class="at">losses_percent</span><span class="op">;</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> targetLosses <span class="op">=</span> <span class="dv">100</span> <span class="op">-</span> targetSE<span class="op">;</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> savingsPotentialPercent <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> currentLosses <span class="op">-</span> targetLosses)<span class="op">;</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Roczne oszczędności GJ</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> savingsPotentialGJ <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((savingsPotentialPercent <span class="op">/</span> <span class="dv">100</span>) <span class="op">*</span> annualGJ)<span class="op">;</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Rekomendacje</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> recommendations <span class="op">=</span> <span class="fu">generateRecommendations</span>(se<span class="op">,</span> kw<span class="op">,</span> ss<span class="op">,</span> primary_issue)<span class="op">;</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    primary_issue<span class="op">,</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    savings_potential_percent<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(savingsPotentialPercent)<span class="op">,</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    savings_potential_gj<span class="op">:</span> savingsPotentialGJ<span class="op">,</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>    recommendations<span class="op">,</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">generateRecommendations</span>(</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>  se<span class="op">:</span> SEDailyResult<span class="op">,</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>  kw<span class="op">:</span> KWResult<span class="op">,</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>  ss<span class="op">:</span> SSResult<span class="op">,</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>  primaryIssue<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> <span class="dt">string</span>[] {</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> recs<span class="op">:</span> <span class="dt">string</span>[] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (primaryIssue <span class="op">===</span> <span class="st">&#39;exchanger&#39;</span>) {</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (kw<span class="op">.</span><span class="at">limiting_factor</span> <span class="op">===</span> <span class="st">&#39;wwc&#39;</span>) {</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>      recs<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;Regulacja zaworów MTCV - woda wraca za ciepła&#39;</span>)<span class="op">;</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (kw<span class="op">.</span><span class="at">limiting_factor</span> <span class="op">===</span> <span class="st">&#39;sh&#39;</span>) {</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>      recs<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;Równoważenie hydrauliczne pionów&#39;</span>)<span class="op">;</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>      recs<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;Optymalizacja pompy w godzinach szczytu&#39;</span>)<span class="op">;</span></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (primaryIssue <span class="op">===</span> <span class="st">&#39;circulation&#39;</span> <span class="op">||</span> ss<span class="op">.</span><span class="at">value</span> <span class="op">&gt;</span> <span class="dv">15</span>) {</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ss<span class="op">.</span><span class="at">night_ratio</span> <span class="op">&gt;</span> <span class="fl">0.25</span>) {</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>      recs<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;Zmniejsz cyrkulację nocną&#39;</span>)<span class="op">;</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>      recs<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;Sprawdź izolację rur cyrkulacyjnych&#39;</span>)<span class="op">;</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> recs<span class="op">;</span></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h3 id="krok-10-złożenie-wszystkiego">KROK 10: Złożenie wszystkiego</h3>
<p><strong>Cel:</strong> Pełny przepływ obliczeniowy.</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> FullCalculationResult {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  node_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  date<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Poziom 3 (operacyjne)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  wwc<span class="op">:</span> WWCResult<span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  sh<span class="op">:</span> SHResult<span class="op">;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  es<span class="op">:</span> ESResult<span class="op">;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Poziom 2 (zagregowane)</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  kw<span class="op">:</span> KWResult<span class="op">;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  ss<span class="op">:</span> SSResult<span class="op">;</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Poziom 1 (główny)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  se<span class="op">:</span> SEDailyResult<span class="op">;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagnostyka</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  diagnostic<span class="op">:</span> DiagnosticResult<span class="op">;</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">calculateAll</span>(</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  nodeId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  date<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  annualGJ<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>FullCalculationResult<span class="op">&gt;</span> {</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 1: Pobierz dane</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> daily <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetchDailyMeasurements</span>(nodeId<span class="op">,</span> date)<span class="op">;</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> month <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date)<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 2: WWC</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wwc <span class="op">=</span> <span class="fu">calculateWWC</span>(daily<span class="op">.</span><span class="at">measurements</span>)<span class="op">;</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 3: SH</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sh <span class="op">=</span> <span class="fu">calculateSH</span>(daily<span class="op">.</span><span class="at">measurements</span>)<span class="op">;</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 4: SE_15min (wszystkie)</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> se15minResults <span class="op">=</span> <span class="fu">calculateAllSE15min</span>(daily<span class="op">.</span><span class="at">measurements</span><span class="op">,</span> month)<span class="op">;</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 5: ES</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> es <span class="op">=</span> <span class="fu">calculateES</span>(se15minResults)<span class="op">;</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 6: KW</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kw <span class="op">=</span> <span class="fu">calculateKW</span>(wwc<span class="op">.</span><span class="at">value</span><span class="op">,</span> sh<span class="op">.</span><span class="at">value</span><span class="op">,</span> es<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 7: SE dobowe</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> se <span class="op">=</span> <span class="fu">calculateSEDaily</span>(daily<span class="op">.</span><span class="at">measurements</span><span class="op">,</span> month)<span class="op">;</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 8: SS</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ss <span class="op">=</span> <span class="fu">calculateSS</span>(se<span class="op">.</span><span class="at">value</span><span class="op">,</span> kw<span class="op">.</span><span class="at">value</span><span class="op">,</span> daily<span class="op">.</span><span class="at">measurements</span>)<span class="op">;</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">// KROK 9: Diagnostyka</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> diagnostic <span class="op">=</span> <span class="fu">diagnose</span>(se<span class="op">,</span> kw<span class="op">,</span> ss<span class="op">,</span> annualGJ)<span class="op">;</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>    node_id<span class="op">:</span> nodeId<span class="op">,</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>    date<span class="op">,</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    wwc<span class="op">,</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>    sh<span class="op">,</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    es<span class="op">,</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    kw<span class="op">,</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    ss<span class="op">,</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    se<span class="op">,</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>    diagnostic<span class="op">,</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="przykład-kompletnego-obliczenia">5. Przykład kompletnego
obliczenia</h2>
<h3 id="dane-wejściowe">Dane wejściowe</h3>
<p><strong>Węzeł:</strong> WC-001 <strong>Data:</strong> 2025-01-14
(styczeń) <strong>Pomiary:</strong> 96 rekordów z MEC SCADA</p>
<h3 id="wyniki-pośrednie">Wyniki pośrednie</h3>
<table>
<thead>
<tr>
<th>Krok</th>
<th>Wskaźnik</th>
<th>Wartość</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>WWC</td>
<td>81%</td>
<td>good</td>
</tr>
<tr>
<td>3</td>
<td>SH</td>
<td>79%</td>
<td>warning</td>
</tr>
<tr>
<td>5</td>
<td>ES</td>
<td>88%</td>
<td>good</td>
</tr>
<tr>
<td>6</td>
<td>KW</td>
<td>83%</td>
<td>good</td>
</tr>
<tr>
<td>7</td>
<td>SE</td>
<td>78%</td>
<td>good</td>
</tr>
<tr>
<td>8</td>
<td>SS</td>
<td>6%</td>
<td>optimal</td>
</tr>
</tbody>
</table>
<h3 id="wynik-końcowy">Wynik końcowy</h3>
<div class="sourceCode" id="cb34"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;node_id&quot;</span><span class="fu">:</span> <span class="st">&quot;WC-001&quot;</span><span class="fu">,</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-01-14&quot;</span><span class="fu">,</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;wwc&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">81</span><span class="fu">,</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;good&quot;</span><span class="fu">,</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;avg_delta_T&quot;</span><span class="fu">:</span> <span class="fl">16.2</span><span class="fu">,</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;interpretation&quot;</span><span class="fu">:</span> <span class="st">&quot;Dobra wymiana ciepła, możliwa drobna optymalizacja&quot;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sh&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">79</span><span class="fu">,</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;warning&quot;</span><span class="fu">,</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;flow_mean&quot;</span><span class="fu">:</span> <span class="fl">2.45</span><span class="fu">,</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;flow_std&quot;</span><span class="fu">:</span> <span class="fl">0.52</span><span class="fu">,</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;cv&quot;</span><span class="fu">:</span> <span class="fl">0.212</span><span class="fu">,</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;interpretation&quot;</span><span class="fu">:</span> <span class="st">&quot;Znaczne wahania przepływu - nierównomierne obciążenie pionów&quot;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;es&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">88</span><span class="fu">,</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;good&quot;</span><span class="fu">,</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;se_peak&quot;</span><span class="fu">:</span> <span class="dv">75</span><span class="fu">,</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;se_average&quot;</span><span class="fu">:</span> <span class="dv">85</span><span class="fu">,</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;worst_hours&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">17</span><span class="ot">,</span> <span class="dv">18</span><span class="ot">,</span> <span class="dv">7</span><span class="ot">,</span> <span class="dv">8</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;interpretation&quot;</span><span class="fu">:</span> <span class="st">&quot;Lekki spadek w szczycie (17:00, 18:00, 7:00, 8:00)&quot;</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kw&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">83</span><span class="fu">,</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;good&quot;</span><span class="fu">,</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;limiting_factor&quot;</span><span class="fu">:</span> <span class="st">&quot;sh&quot;</span><span class="fu">,</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;interpretation&quot;</span><span class="fu">:</span> <span class="st">&quot;Wymiennik sprawny, ogranicza: stabilność hydrauliczna&quot;</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ss&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">6</span><span class="fu">,</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;optimal&quot;</span><span class="fu">,</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;estimated_circulation&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;estimated_pipes&quot;</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;night_ratio&quot;</span><span class="fu">:</span> <span class="fl">0.18</span><span class="fu">,</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;interpretation&quot;</span><span class="fu">:</span> <span class="st">&quot;Minimalne straty systemowe&quot;</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;se&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">78</span><span class="fu">,</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;good&quot;</span><span class="fu">,</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;losses_percent&quot;</span><span class="fu">:</span> <span class="dv">22</span><span class="fu">,</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;q_theoretical&quot;</span><span class="fu">:</span> <span class="fl">4.22</span><span class="fu">,</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;q_actual&quot;</span><span class="fu">:</span> <span class="fl">5.41</span><span class="fu">,</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;t_cold&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;interpretation&quot;</span><span class="fu">:</span> <span class="st">&quot;78% energii wykorzystane, 22% strat w systemie&quot;</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;diagnostic&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;primary_issue&quot;</span><span class="fu">:</span> <span class="st">&quot;balanced&quot;</span><span class="fu">,</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;savings_potential_percent&quot;</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;savings_potential_gj&quot;</span><span class="fu">:</span> <span class="dv">24</span><span class="fu">,</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;recommendations&quot;</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="obsługa-błędów">6. Obsługa błędów</h2>
<h3 id="brakujące-dane">6.1 Brakujące dane</h3>
<div class="sourceCode" id="cb35"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">validateMeasurements</span>(measurements<span class="op">:</span> ScadaMeasurement[])<span class="op">:</span> ValidationResult {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> issues<span class="op">:</span> <span class="dt">string</span>[] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Sprawdź liczbę pomiarów</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (measurements<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">48</span>) {</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    issues<span class="op">.</span><span class="fu">push</span>(<span class="vs">`Za mało pomiarów: </span><span class="sc">${</span>measurements<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">/96`</span>)<span class="op">;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Sprawdź luki czasowe</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gaps <span class="op">=</span> <span class="fu">findTimeGaps</span>(measurements)<span class="op">;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (gaps<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    issues<span class="op">.</span><span class="fu">push</span>(<span class="vs">`Luki w danych: </span><span class="sc">${</span>gaps<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> okresów`</span>)<span class="op">;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Sprawdź wartości zerowe</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zeroFlows <span class="op">=</span> measurements<span class="op">.</span><span class="fu">filter</span>(m <span class="kw">=&gt;</span> m<span class="op">.</span><span class="at">Q_flow</span> <span class="op">===</span> <span class="dv">0</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (zeroFlows <span class="op">&gt;</span> <span class="dv">10</span>) {</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    issues<span class="op">.</span><span class="fu">push</span>(<span class="vs">`Wiele zerowych przepływów: </span><span class="sc">${</span>zeroFlows<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    valid<span class="op">:</span> issues<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    issues<span class="op">,</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    coverage<span class="op">:</span> measurements<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">96</span><span class="op">,</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="wartości-odstające">6.2 Wartości odstające</h3>
<div class="sourceCode" id="cb36"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">removeOutliers</span>(values<span class="op">:</span> <span class="dt">number</span>[]<span class="op">,</span> stdMultiplier<span class="op">:</span> <span class="dt">number</span> <span class="op">=</span> <span class="dv">3</span>)<span class="op">:</span> <span class="dt">number</span>[] {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mean <span class="op">=</span> values<span class="op">.</span><span class="fu">reduce</span>((s<span class="op">,</span> v) <span class="kw">=&gt;</span> s <span class="op">+</span> v<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> values<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> std <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">.</span><span class="fu">reduce</span>((s<span class="op">,</span> v) <span class="kw">=&gt;</span> s <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(v <span class="op">-</span> mean<span class="op">,</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> values<span class="op">.</span><span class="at">length</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lowerBound <span class="op">=</span> mean <span class="op">-</span> stdMultiplier <span class="op">*</span> std<span class="op">;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upperBound <span class="op">=</span> mean <span class="op">+</span> stdMultiplier <span class="op">*</span> std<span class="op">;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> values<span class="op">.</span><span class="fu">filter</span>(v <span class="kw">=&gt;</span> v <span class="op">&gt;=</span> lowerBound <span class="op">&amp;&amp;</span> v <span class="op">&lt;=</span> upperBound)<span class="op">;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="podsumowanie-wzorów">7. Podsumowanie wzorów</h2>
<table>
<thead>
<tr>
<th>Wskaźnik</th>
<th>Wzór</th>
<th>Źródło danych</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SE</strong></td>
<td><code>(Q_teor / Q_rzecz) × 100</code></td>
<td>KSM lub MEC</td>
</tr>
<tr>
<td><strong>WWC</strong></td>
<td><code>(ΔT_rzecz / 20) × 100</code></td>
<td>MEC: T_zas, T_pow</td>
</tr>
<tr>
<td><strong>SH</strong></td>
<td><code>100 - CV(Q) × 100</code></td>
<td>MEC: Q_flow (24h)</td>
</tr>
<tr>
<td><strong>ES</strong></td>
<td><code>(SE_szczyt / SE_śr) × 100</code></td>
<td>MEC: SE godzinowe</td>
</tr>
<tr>
<td><strong>KW</strong></td>
<td><code>∛(WWC × SH × ES)</code></td>
<td>Obliczane</td>
</tr>
<tr>
<td><strong>SS</strong></td>
<td><code>100 × (1 - SE/KW)</code></td>
<td>Obliczane</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="historia-zmian">8. Historia zmian</h2>
<table>
<thead>
<tr>
<th>Wersja</th>
<th>Data</th>
<th>Zmiany</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>2025-01-10</td>
<td>Wersja początkowa</td>
</tr>
<tr>
<td>2.0</td>
<td>2025-01-14</td>
<td>Pełna dokumentacja od danych surowych MEC SCADA</td>
</tr>
</tbody>
</table>

<div class="doc-footer">
  CWU Monitor • KSM Przylesie • Koszalin • Wersja dokumentacji: 2025-01-14
</div>

<script>
// Automatyczne wykrywanie diagramów ASCII i formuł matematycznych
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('pre code').forEach(function(block) {
    var text = block.textContent;
    var pre = block.parentElement;

    // Wykryj diagramy ASCII (box-drawing characters)
    var isDiagram = text.includes('┌') || text.includes('│') || text.includes('└') ||
                    text.includes('├') || text.includes('┬') || text.includes('─') ||
                    text.includes('▼') || text.includes('▲') || text.includes('►') ||
                    text.includes('═') || text.includes('║') || text.includes('╔');

    if (isDiagram) {
      pre.classList.add('diagram');
      return;
    }

    // Wykryj formuły matematyczne
    var hasEquals = text.includes('=');
    var hasMathSymbols = text.includes('×') || text.includes('÷') ||
                         text.includes('∛') || text.includes('√');
    var hasCode = text.includes('function') || text.includes('const ') ||
                  text.includes('interface') || text.includes('async') ||
                  text.includes('return ') || text.includes('import ') ||
                  text.includes('//') || text.includes('=>');
    var lines = text.trim().split('\n');
    var isShort = lines.length <= 15;

    // Dodatkowe sygnały że to wzór fizyczny
    var hasPhysicsTerms = text.includes('gdzie:') || text.includes('Q_') ||
                          text.includes('T_') || text.includes('ΔT') ||
                          text.includes('[GJ]') || text.includes('[m³]') ||
                          text.includes('[K]') || text.includes('[°C]');

    if (((hasEquals || hasMathSymbols) && !hasCode && isShort) ||
        (hasPhysicsTerms && hasEquals && !hasCode)) {
      pre.classList.add('math-formula');
    }
  });
});
</script>
</body>
</html>
